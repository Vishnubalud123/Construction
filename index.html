<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGK Construction - Complete Project Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        main {
            padding: 2rem 0;
            min-height: calc(100vh - 180px);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .btn {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #219955;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }
        
        .project-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .overview-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .overview-card:hover {
            transform: translateY(-5px);
        }
        
        .overview-card i {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .overview-card h3 {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .overview-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .specifications {
            margin-top: 30px;
        }
        
        .spec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .spec-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .spec-item i {
            color: var(--secondary);
            font-size: 1.5rem;
        }
        
        .payment-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .summary-card.total i {
            color: var(--primary);
        }
        
        .summary-card.paid i {
            color: var(--success);
        }
        
        .summary-card.balance i {
            color: var(--warning);
        }
        
        .summary-card h3 {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .summary-card.total .value {
            color: var(--primary);
        }
        
        .summary-card.paid .value {
            color: var(--success);
        }
        
        .summary-card.balance .value {
            color: var(--warning);
        }
        
        .progress-container {
            margin-top: 30px;
        }
        
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .construction-container {
            display: flex;
            gap: 30px;
        }
        
        .construction-form {
            flex: 1;
        }
        
        .stage-list {
            flex: 1;
            margin-top: 0;
        }
        
        .stage {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .stage:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stage-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.2rem;
            color: white;
        }
        
        .stage.completed .stage-icon {
            background: var(--success);
        }
        
        .stage.in-progress .stage-icon {
            background: var(--warning);
        }
        
        .stage.pending .stage-icon {
            background: var(--gray);
        }
        
        .stage-details {
            flex-grow: 1;
        }
        
        .stage-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .stage-details p {
            color: var(--gray);
        }
        
        .stage-amount {
            font-weight: 700;
            font-size: 1.2rem;
            margin-right: 15px;
        }
        
        .stage-payment-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-right: 15px;
        }
        
        .stage-paid {
            font-weight: 600;
            color: var(--success);
        }
        
        .stage-balance {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .stage-actions {
            display: flex;
            gap: 10px;
        }
        
        .stage-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--secondary);
            transition: color 0.3s;
        }
        
        .stage-action-btn:hover {
            color: var(--primary);
        }
        
        .expenses-container {
            display: flex;
            gap: 30px;
        }
        
        .expenses-form {
            flex: 1;
        }
        
        .expenses-list {
            flex: 1;
        }
        
        .expense-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .expense-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .expense-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.2rem;
            color: white;
        }
        
        .expense-item.paid .expense-icon {
            background: var(--success);
        }
        
        .expense-item.pending .expense-icon {
            background: var(--warning);
        }
        
        .expense-details {
            flex-grow: 1;
        }
        
        .expense-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .expense-details p {
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .expense-amount {
            font-weight: 700;
            font-size: 1.2rem;
            margin-right: 15px;
        }
        
        .expense-payment-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-right: 15px;
        }
        
        .expense-paid {
            font-weight: 600;
            color: var(--success);
        }
        
        .expense-balance {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .expense-actions {
            display: flex;
            gap: 10px;
        }
        
        .expense-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--secondary);
            transition: color 0.3s;
        }
        
        .expense-action-btn:hover {
            color: var(--primary);
        }
        
        .payment-history {
            margin-top: 30px;
        }
        
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .payment-table th,
        .payment-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .payment-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--primary);
        }
        
        .payment-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .payment-table .amount {
            font-weight: 600;
            color: var(--success);
        }
        
        .payment-table .date {
            color: var(--gray);
        }
        
        .payment-table .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .payment-table .status.completed {
            background-color: #e8f5e9;
            color: var(--success);
        }
        
        .payment-table .status.pending {
            background-color: #fff3e0;
            color: var(--warning);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        footer {
            background: var(--dark);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .footer-logo {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .footer-copyright {
            color: #bbb;
            font-size: 0.9rem;
        }
        
        .footer-links a {
            color: white;
            margin-left: 20px;
            text-decoration: none;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
            }
            
            .project-overview {
                grid-template-columns: 1fr;
            }
            
            .spec-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-summary {
                grid-template-columns: 1fr;
            }
            
            .construction-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .expenses-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .stage {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .stage-payment-info {
                align-items: flex-start;
            }
            
            .expense-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .expense-payment-info {
                align-items: flex-start;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .footer-links a {
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-hard-hat"></i>
                    <h1>PGK Construction</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="construction">Construction</a></li>
                        <li><a href="#" class="nav-link" data-page="expenses">Other Expenses</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Home Page -->
        <section id="home" class="page active">
            <div class="card">
                <div class="card-header">
                    <h2>Project Overview</h2>
                    <a href="#" class="btn btn-success"><i class="fas fa-download"></i> Download Quotation</a>
                </div>
                
                <div class="project-overview">
                    <div class="overview-card">
                        <i class="fas fa-user-hard-hat"></i>
                        <h3>Engineer</h3>
                        <div class="value">Er. P. Govindaraj</div>
                    </div>
                    <div class="overview-card">
                        <i class="fas fa-calculator"></i>
                        <h3>Per Sqft Rate</h3>
                        <div class="value">₹1,650</div>
                    </div>
                    <div class="overview-card">
                        <i class="fas fa-ruler-combined"></i>
                        <h3>Total Sqft</h3>
                        <div class="value">625 Sqft</div>
                    </div>
                    <div class="overview-card">
                        <i class="fas fa-rupee-sign"></i>
                        <h3>Total Cost</h3>
                        <div class="value">₹10,31,250</div>
                    </div>
                </div>
            </div>
            
            <div class="card specifications">
                <div class="card-header">
                    <h2>House Specifications</h2>
                </div>
                
                <div class="spec-grid">
                    <div class="spec-item">
                        <i class="fas fa-layer-group"></i>
                        <div>
                            <h3>Foundation</h3>
                            <p>Concrete with steel reinforcement</p>
                        </div>
                    </div>
                    <div class="spec-item">
                        <i class="fas fa-cube"></i>
                        <div>
                            <h3>Structure</h3>
                            <p>RCC framed structure</p>
                        </div>
                    </div>
                    <div class="spec-item">
                        <i class="fas fa-border-style"></i>
                        <div>
                            <h3>Walls</h3>
                            <p>9" thick brick walls</p>
                        </div>
                    </div>
                    <div class="spec-item">
                        <i class="fas fa-tint"></i>
                        <div>
                            <h3>Plumbing</h3>
                            <p>CPVC pipes with modern fixtures</p>
                        </div>
                    </div>
                    <div class="spec-item">
                        <i class="fas fa-bolt"></i>
                        <div>
                            <h3>Electrical</h3>
                            <p>Concealed copper wiring</p>
                        </div>
                    </div>
                    <div class="spec-item">
                        <i class="fas fa-paint-roller"></i>
                        <div>
                            <h3>Finishing</h3>
                            <p>Premium quality paints</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Construction Page -->
        <section id="construction" class="page">
            <div class="card">
                <div class="card-header">
                    <h2>Construction Progress</h2>
                    <button class="btn" id="add-stage-btn"><i class="fas fa-plus"></i> Add Stage</button>
                </div>
                
                <div class="payment-summary">
                    <div class="summary-card total">
                        <i class="fas fa-receipt"></i>
                        <h3>Total Construction Cost</h3>
                        <div class="value" id="construction-total">₹10,31,250</div>
                    </div>
                    
                    <div class="summary-card paid">
                        <i class="fas fa-check-circle"></i>
                        <h3>Paid Amount</h3>
                        <div class="value" id="construction-paid">₹2,06,250</div>
                    </div>
                    
                    <div class="summary-card balance">
                        <i class="fas fa-clock"></i>
                        <h3>Balance Amount</h3>
                        <div class="value" id="construction-balance">₹8,25,000</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <div>
                            <h3>Overall Progress</h3>
                            <p id="overall-progress">20% completed</p>
                        </div>
                        <div>
                            <h3>Construction Status</h3>
                            <p id="current-status">Advance completed</p>
                        </div>
                        <div>
                            <h3>Last Updated</h3>
                            <p id="last-updated">2023-10-15</p>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar" style="width: 20%"></div>
                    </div>
                </div>
                
                <div class="construction-container">
                    <div class="construction-form">
                        <h3 style="margin-bottom: 20px;" id="construction-form-title">Add New Stage</h3>
                        
                        <form id="stage-form">
                            <div class="form-group">
                                <label for="stage-name">Stage Name</label>
                                <input type="text" id="stage-name" class="form-control" placeholder="Enter stage name" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="stage-percentage">Percentage (%)</label>
                                    <input type="number" id="stage-percentage" class="form-control" placeholder="Enter percentage" min="1" max="100" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="stage-date">Start Date</label>
                                    <input type="date" id="stage-date" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="stage-notes">Notes</label>
                                <textarea id="stage-notes" class="form-control" rows="3" placeholder="Add any notes about this stage"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="stage-submit-btn"><i class="fas fa-save"></i> Save Stage</button>
                                <button type="button" class="btn btn-danger" id="stage-cancel-btn" style="display: none;"><i class="fas fa-times"></i> Cancel</button>
                                <button type="button" class="btn btn-warning" id="reset-stage-form"><i class="fas fa-undo"></i> Reset</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="stage-list">
                        <h3 style="margin-bottom: 20px;">Construction Stages</h3>
                        
                        <div id="stages-list-container">
                            <!-- Stages will be dynamically added here -->
                        </div>
                    </div>
                </div>
                
                <div class="payment-history">
                    <h3 style="margin-bottom: 20px;">Payment History</h3>
                    
                    <table class="payment-table" id="construction-payment-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Stage</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Payment records will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Other Expenses Page -->
        <section id="expenses" class="page">
            <div class="card">
                <div class="card-header">
                    <h2>Other Construction Expenses</h2>
                    <button class="btn" id="add-expense-btn"><i class="fas fa-plus"></i> Add Expense</button>
                </div>
                
                <div class="payment-summary">
                    <div class="summary-card total">
                        <i class="fas fa-receipt"></i>
                        <h3>Total Expenses</h3>
                        <div class="value" id="expenses-total">₹90,000</div>
                    </div>
                    
                    <div class="summary-card paid">
                        <i class="fas fa-check-circle"></i>
                        <h3>Paid Amount</h3>
                        <div class="value" id="expenses-paid">₹65,000</div>
                    </div>
                    
                    <div class="summary-card balance">
                        <i class="fas fa-clock"></i>
                        <h3>Balance Amount</h3>
                        <div class="value" id="expenses-balance">₹25,000</div>
                    </div>
                </div>
                
                <div class="expenses-container">
                    <div class="expenses-form">
                        <h3 style="margin-bottom: 20px;" id="form-title">Add New Expense</h3>
                        
                        <form id="expense-form">
                            <div class="form-group">
                                <label for="expense-name">Expense Name</label>
                                <input type="text" id="expense-name" class="form-control" placeholder="Enter expense name" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expense-amount">Total Amount (₹)</label>
                                    <input type="number" id="expense-amount" class="form-control" placeholder="Enter total amount" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="expense-date">Date</label>
                                    <input type="date" id="expense-date" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-category">Category</label>
                                <select id="expense-category" class="form-control">
                                    <option value="borewell">Borewell</option>
                                    <option value="sump">Sump</option>
                                    <option value="septic-tank">Septic Tank</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="plumbing">Plumbing</option>
                                    <option value="material">Material</option>
                                    <option value="labor">Labor</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="expense-notes">Notes</label>
                                <textarea id="expense-notes" class="form-control" rows="3" placeholder="Add any notes about this expense"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="submit-btn"><i class="fas fa-save"></i> Save Expense</button>
                                <button type="button" class="btn btn-danger" id="cancel-btn" style="display: none;"><i class="fas fa-times"></i> Cancel</button>
                                <button type="button" class="btn btn-warning" id="reset-expense-form"><i class="fas fa-undo"></i> Reset</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="expenses-list">
                        <h3 style="margin-bottom: 20px;">Expense History</h3>
                        
                        <div id="expenses-list-container">
                            <!-- Expenses will be dynamically added here -->
                        </div>
                    </div>
                </div>
                
                <div class="payment-history">
                    <h3 style="margin-bottom: 20px;">Expense Payment History</h3>
                    
                    <table class="payment-table" id="expenses-payment-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Expense</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Expense payment records will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Payment Modal -->
    <div class="modal" id="payment-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add Payment</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="payment-form">
                <input type="hidden" id="payment-type">
                <input type="hidden" id="payment-item-id">
                <input type="hidden" id="payment-total-amount">
                <input type="hidden" id="payment-already-paid">
                
                <div class="form-group">
                    <label for="payment-date">Payment Date</label>
                    <input type="date" id="payment-date" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="payment-amount">Amount (₹)</label>
                    <input type="number" id="payment-amount" class="form-control" placeholder="Enter payment amount" required>
                    <small id="balance-info" style="color: var(--gray); margin-top: 5px; display: block;"></small>
                </div>
                
                <div class="form-group">
                    <label for="payment-description">Description</label>
                    <input type="text" id="payment-description" class="form-control" placeholder="Enter payment description">
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Save Payment</button>
                    <button type="button" class="btn btn-danger" id="cancel-payment">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">PGK Construction</div>
                <div class="footer-copyright">
                    &copy; 2023 All Rights Reserved by VishnuBalu
                </div>
                <div class="footer-links">
                    <a href="#"><i class="fas fa-phone"></i> Contact</a>
                    <a href="#"><i class="fas fa-envelope"></i> Email</a>
                    <a href="#"><i class="fas fa-map-marker-alt"></i> Location</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Navigation between pages
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Show selected page
                const pageId = this.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
            });
        });

        // Construction data model
        const constructionData = {
            projectName: "PGK Construction",
            engineer: "Er. P. Govindaraj",
            perSqftRate: 1650,
            totalSqft: 625,
            totalCost: 1031250,
            lastUpdated: "2023-10-15",
            stages: [
                { 
                    id: "advance", 
                    name: "Advance", 
                    percentage: 20, 
                    amount: 206250, 
                    paid: 206250, 
                    status: "completed", 
                    date: "2023-09-01", 
                    notes: "Initial payment received" 
                },
                { 
                    id: "basement", 
                    name: "Basement", 
                    percentage: 15, 
                    amount: 154687, 
                    paid: 50000, 
                    status: "in-progress", 
                    date: "2023-09-15", 
                    notes: "Excavation completed, foundation work in progress" 
                },
                { 
                    id: "lintel", 
                    name: "Lintel", 
                    percentage: 15, 
                    amount: 154687, 
                    paid: 0, 
                    status: "pending", 
                    date: "", 
                    notes: "" 
                }
            ],
            payments: [
                { 
                    id: 1, 
                    type: "construction",
                    itemId: "advance", 
                    date: "2023-09-01", 
                    amount: 206250, 
                    description: "Initial payment", 
                    status: "completed" 
                },
                { 
                    id: 2, 
                    type: "construction",
                    itemId: "basement", 
                    date: "2023-09-15", 
                    amount: 50000, 
                    description: "First installment", 
                    status: "pending" 
                }
            ]
        };

        // Expenses data model
        let expensesData = [
            { 
                id: 1, 
                name: "Borewell", 
                amount: 50000, 
                paid: 50000, 
                date: "2023-09-10", 
                category: "borewell", 
                status: "paid", 
                notes: "Completed successfully with good water flow" 
            },
            { 
                id: 2, 
                name: "Sump", 
                amount: 15000, 
                paid: 15000, 
                date: "2023-09-20", 
                category: "sump", 
                status: "paid", 
                notes: "5000L capacity sump installed" 
            },
            { 
                id: 3, 
                name: "Septic Tank", 
                amount: 25000, 
                paid: 0, 
                date: "2023-10-05", 
                category: "septic-tank", 
                status: "pending", 
                notes: "Installation in progress" 
            }
        ];

        let expensePayments = [
            { 
                id: 1, 
                type: "expense", 
                itemId: 1, 
                date: "2023-09-10", 
                amount: 50000, 
                description: "Full payment", 
                status: "completed" 
            },
            { 
                id: 2, 
                type: "expense", 
                itemId: 2, 
                date: "2023-09-20", 
                amount: 15000, 
                description: "Full payment", 
                status: "completed" 
            }
        ];

        let editingStageId = null;
        let editingExpenseId = null;
        let paymentIdCounter = 3;

        // Initialize the page with data
        document.addEventListener('DOMContentLoaded', function() {
            updateConstructionDisplay();
            updateExpensesDisplay();
            
            // Set today's date as default for forms
            document.getElementById('stage-date').valueAsDate = new Date();
            document.getElementById('expense-date').valueAsDate = new Date();
            document.getElementById('payment-date').valueAsDate = new Date();
            
            // Construction page event listeners
            document.getElementById('stage-form').addEventListener('submit', function(e) {
                e.preventDefault();
                if (editingStageId) {
                    updateStage();
                } else {
                    addStage();
                }
            });
            
            document.getElementById('reset-stage-form').addEventListener('click', function() {
                resetStageForm();
            });
            
            document.getElementById('stage-cancel-btn').addEventListener('click', function() {
                cancelStageEdit();
            });
            
            document.querySelectorAll('.add-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    const totalAmount = parseInt(this.getAttribute('data-total'));
                    const alreadyPaid = parseInt(this.getAttribute('data-paid'));
                    openPaymentModal('construction', stageId, totalAmount, alreadyPaid);
                });
            });
            
            document.querySelectorAll('.edit-stage').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    editStage(stageId);
                });
            });
            
            document.querySelectorAll('.delete-stage').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    deleteStage(stageId);
                });
            });
            
            document.getElementById('add-stage-btn').addEventListener('click', function() {
                document.getElementById('stage-form').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Expenses page event listeners
            document.getElementById('expense-form').addEventListener('submit', function(e) {
                e.preventDefault();
                if (editingExpenseId) {
                    updateExpense();
                } else {
                    addExpense();
                }
            });
            
            document.getElementById('reset-expense-form').addEventListener('click', function() {
                resetExpenseForm();
            });
            
            document.getElementById('cancel-btn').addEventListener('click', function() {
                cancelExpenseEdit();
            });
            
            document.querySelectorAll('.edit-expense').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    editExpense(expenseId);
                });
            });
            
            document.querySelectorAll('.delete-expense').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    deleteExpense(expenseId);
                });
            });
            
            document.querySelectorAll('.add-expense-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    const totalAmount = parseInt(this.getAttribute('data-total'));
                    const alreadyPaid = parseInt(this.getAttribute('data-paid'));
                    openPaymentModal('expense', expenseId, totalAmount, alreadyPaid);
                });
            });
            
            document.getElementById('add-expense-btn').addEventListener('click', function() {
                document.getElementById('expense-form').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Payment modal event listeners
            document.getElementById('close-modal').addEventListener('click', function() {
                closePaymentModal();
            });
            
            document.getElementById('cancel-payment').addEventListener('click', function() {
                closePaymentModal();
            });
            
            document.getElementById('payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                savePayment();
            });
            
            // Update payment amount info when amount changes
            document.getElementById('payment-amount').addEventListener('input', function() {
                updatePaymentInfo();
            });
        });

        // Update construction display based on data
        function updateConstructionDisplay() {
            const completedStages = constructionData.stages.filter(stage => stage.status === "completed");
            const inProgressStages = constructionData.stages.filter(stage => stage.status === "in-progress");
            
            // Calculate payment totals
            const totalAmount = constructionData.totalCost;
            const paidAmount = constructionData.stages.reduce((sum, stage) => sum + stage.paid, 0);
            const balanceAmount = totalAmount - paidAmount;
            
            // Update payment summary cards
            document.getElementById('construction-total').textContent = `₹${totalAmount.toLocaleString('en-IN')}`;
            document.getElementById('construction-paid').textContent = `₹${paidAmount.toLocaleString('en-IN')}`;
            document.getElementById('construction-balance').textContent = `₹${balanceAmount.toLocaleString('en-IN')}`;
            
            // Calculate overall progress
            const totalPercentage = completedStages.reduce((sum, stage) => sum + stage.percentage, 0);
            document.getElementById('progress-bar').style.width = `${totalPercentage}%`;
            document.getElementById('overall-progress').textContent = `${totalPercentage}% completed`;
            
            // Update current status
            if (inProgressStages.length > 0) {
                document.getElementById('current-status').textContent = `${inProgressStages[0].name} in progress`;
            } else if (totalPercentage === 100) {
                document.getElementById('current-status').textContent = "Project Completed";
            } else {
                document.getElementById('current-status').textContent = "Advance completed";
            }
            
            // Update last updated date
            document.getElementById('last-updated').textContent = constructionData.lastUpdated;
            
            // Update stage list display
            updateStageList();
            
            // Update payment history table
            updateConstructionPaymentTable();
        }

        // Update stage list in the UI
        function updateStageList() {
            const stagesList = document.getElementById('stages-list-container');
            
            // Clear existing stages
            stagesList.innerHTML = '';
            
            // Check if there are any stages
            if (constructionData.stages.length === 0) {
                stagesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <h3>No Stages Added</h3>
                        <p>Click "Add Stage" to create your first construction stage</p>
                    </div>
                `;
                return;
            }
            
            // Add updated stages
            constructionData.stages.forEach(stage => {
                const stageElement = document.createElement('div');
                stageElement.className = `stage ${stage.status}`;
                
                let iconClass = 'fas fa-clock';
                if (stage.status === 'completed') iconClass = 'fas fa-check';
                if (stage.status === 'in-progress') iconClass = 'fas fa-tools';
                
                const balance = stage.amount - stage.paid;
                
                stageElement.innerHTML = `
                    <div class="stage-icon">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="stage-details">
                        <h3>${stage.name}</h3>
                        <p>${stage.percentage}% of total cost | Total: ₹${stage.amount.toLocaleString('en-IN')}</p>
                        ${stage.notes ? `<p><small>${stage.notes}</small></p>` : ''}
                    </div>
                    <div class="stage-payment-info">
                        <div class="stage-paid">Paid: ₹${stage.paid.toLocaleString('en-IN')}</div>
                        <div class="stage-balance">Balance: ₹${balance.toLocaleString('en-IN')}</div>
                    </div>
                    <div class="stage-actions">
                        <button class="btn btn-success btn-sm add-payment-btn" data-stage="${stage.id}" data-total="${stage.amount}" data-paid="${stage.paid}"><i class="fas fa-plus"></i> Add Payment</button>
                        <button class="stage-action-btn edit-stage" data-stage="${stage.id}"><i class="fas fa-edit"></i></button>
                        <button class="stage-action-btn delete-stage" data-stage="${stage.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                stagesList.appendChild(stageElement);
            });
            
            // Re-attach event listeners to the new buttons
            document.querySelectorAll('.add-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    const totalAmount = parseInt(this.getAttribute('data-total'));
                    const alreadyPaid = parseInt(this.getAttribute('data-paid'));
                    openPaymentModal('construction', stageId, totalAmount, alreadyPaid);
                });
            });
            
            document.querySelectorAll('.edit-stage').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    editStage(stageId);
                });
            });
            
            document.querySelectorAll('.delete-stage').forEach(button => {
                button.addEventListener('click', function() {
                    const stageId = this.getAttribute('data-stage');
                    deleteStage(stageId);
                });
            });
        }

        // Add a new stage
        function addStage() {
            const name = document.getElementById('stage-name').value;
            const percentage = parseInt(document.getElementById('stage-percentage').value);
            const date = document.getElementById('stage-date').value;
            const notes = document.getElementById('stage-notes').value;
            
            // Calculate stage amount
            const amount = Math.round((percentage / 100) * constructionData.totalCost);
            
            // Generate a new ID
            const newId = name.toLowerCase().replace(/\s+/g, '-');
            
            // Check if stage with same ID already exists
            if (constructionData.stages.find(stage => stage.id === newId)) {
                alert('A stage with this name already exists. Please use a different name.');
                return;
            }
            
            // Create new stage object
            const newStage = {
                id: newId,
                name,
                percentage,
                amount,
                paid: 0,
                status: "pending",
                date,
                notes
            };
            
            // Add to data array
            constructionData.stages.push(newStage);
            
            // Update display
            updateConstructionDisplay();
            
            // Reset form
            resetStageForm();
            
            // Show success message
            alert(`Stage "${name}" added successfully!`);
        }

        // Edit a stage (populate form with existing data)
        function editStage(stageId) {
            const stage = constructionData.stages.find(stage => stage.id === stageId);
            if (!stage) return;
            
            // Populate form with stage data
            document.getElementById('stage-name').value = stage.name;
            document.getElementById('stage-percentage').value = stage.percentage;
            document.getElementById('stage-date').value = stage.date;
            document.getElementById('stage-notes').value = stage.notes || '';
            
            // Update UI for editing mode
            editingStageId = stageId;
            document.getElementById('construction-form-title').textContent = 'Edit Stage';
            document.getElementById('stage-submit-btn').innerHTML = '<i class="fas fa-save"></i> Update Stage';
            document.getElementById('stage-cancel-btn').style.display = 'inline-block';
            
            // Scroll to the form
            document.getElementById('stage-form').scrollIntoView({ behavior: 'smooth' });
        }

        // Update an existing stage
        function updateStage() {
            const name = document.getElementById('stage-name').value;
            const percentage = parseInt(document.getElementById('stage-percentage').value);
            const date = document.getElementById('stage-date').value;
            const notes = document.getElementById('stage-notes').value;
            
            // Find the stage in our data
            const stageIndex = constructionData.stages.findIndex(stage => stage.id === editingStageId);
            if (stageIndex === -1) return;
            
            // Calculate new amount
            const amount = Math.round((percentage / 100) * constructionData.totalCost);
            
            // Update the stage
            constructionData.stages[stageIndex] = {
                ...constructionData.stages[stageIndex],
                name,
                percentage,
                amount,
                date,
                notes
            };
            
            // Update display
            updateConstructionDisplay();
            
            // Reset form and exit editing mode
            cancelStageEdit();
            
            // Show success message
            alert(`Stage "${name}" updated successfully!`);
        }

        // Delete a stage
        function deleteStage(stageId) {
            if (!confirm('Are you sure you want to delete this stage?')) return;
            
            const stageIndex = constructionData.stages.findIndex(stage => stage.id === stageId);
            if (stageIndex === -1) return;
            
            const stageName = constructionData.stages[stageIndex].name;
            
            // Also delete associated payments
            constructionData.payments = constructionData.payments.filter(payment => payment.itemId !== stageId);
            
            constructionData.stages.splice(stageIndex, 1);
            updateConstructionDisplay();
            alert(`Stage "${stageName}" deleted successfully!`);
        }

        // Reset the stage form
        function resetStageForm() {
            document.getElementById('stage-form').reset();
            document.getElementById('stage-date').valueAsDate = new Date();
        }

        // Cancel editing and reset stage form
        function cancelStageEdit() {
            editingStageId = null;
            document.getElementById('construction-form-title').textContent = 'Add New Stage';
            document.getElementById('stage-submit-btn').innerHTML = '<i class="fas fa-save"></i> Save Stage';
            document.getElementById('stage-cancel-btn').style.display = 'none';
            resetStageForm();
        }

        // Update construction payment table
        function updateConstructionPaymentTable() {
            const tableBody = document.querySelector('#construction-payment-table tbody');
            tableBody.innerHTML = '';
            
            if (constructionData.payments.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: var(--gray);">
                            <i class="fas fa-receipt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            No payment records found
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort payments by date (newest first)
            const sortedPayments = [...constructionData.payments].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedPayments.forEach(payment => {
                const stage = constructionData.stages.find(stage => stage.id === payment.itemId);
                const stageName = stage ? stage.name : 'Unknown';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="date">${payment.date}</td>
                    <td>${stageName}</td>
                    <td>${payment.description}</td>
                    <td class="amount">₹${payment.amount.toLocaleString('en-IN')}</td>
                    <td><span class="status ${payment.status}">${payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm delete-payment-btn" data-id="${payment.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Re-attach event listeners
            document.querySelectorAll('.delete-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const paymentId = parseInt(this.getAttribute('data-id'));
                    deletePayment(paymentId);
                });
            });
        }

        // Update expenses display based on data
        function updateExpensesDisplay() {
            // Calculate summary values
            const totalExpenses = expensesData.reduce((sum, expense) => sum + expense.amount, 0);
            const paidExpenses = expensesData.reduce((sum, expense) => sum + expense.paid, 0);
            const balanceExpenses = totalExpenses - paidExpenses;
            
            // Update summary cards
            document.getElementById('expenses-total').textContent = `₹${totalExpenses.toLocaleString('en-IN')}`;
            document.getElementById('expenses-paid').textContent = `₹${paidExpenses.toLocaleString('en-IN')}`;
            document.getElementById('expenses-balance').textContent = `₹${balanceExpenses.toLocaleString('en-IN')}`;
            
            // Update expenses list
            updateExpensesList();
            
            // Update expense payment table
            updateExpensePaymentTable();
        }

        // Update expenses list in the UI
        function updateExpensesList() {
            const expensesList = document.getElementById('expenses-list-container');
            
            // Clear existing expenses
            expensesList.innerHTML = '';
            
            // Check if there are any expenses
            if (expensesData.length === 0) {
                expensesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-receipt"></i>
                        <h3>No Expenses Added</h3>
                        <p>Click "Add Expense" to record your first expense</p>
                    </div>
                `;
                return;
            }
            
            // Sort expenses by date (newest first)
            const sortedExpenses = [...expensesData].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Add expenses to the list
            sortedExpenses.forEach(expense => {
                const expenseElement = document.createElement('div');
                expenseElement.className = `expense-item ${expense.status}`;
                
                // Set icon based on category
                let iconClass = 'fas fa-receipt';
                if (expense.category === 'borewell') iconClass = 'fas fa-water';
                if (expense.category === 'sump') iconClass = 'fas fa-tint';
                if (expense.category === 'septic-tank') iconClass = 'fas fa-recycle';
                if (expense.category === 'electrical') iconClass = 'fas fa-bolt';
                if (expense.category === 'plumbing') iconClass = 'fas fa-wrench';
                if (expense.category === 'material') iconClass = 'fas fa-box';
                if (expense.category === 'labor') iconClass = 'fas fa-hard-hat';
                
                const balance = expense.amount - expense.paid;
                
                expenseElement.innerHTML = `
                    <div class="expense-icon">
                        <i class="${iconClass}"></i>
                    </div>
                    <div class="expense-details">
                        <h3>${expense.name}</h3>
                        <p>${expense.date} | ${formatCategory(expense.category)}</p>
                        ${expense.notes ? `<p>${expense.notes}</p>` : ''}
                    </div>
                    <div class="expense-amount">₹${expense.amount.toLocaleString('en-IN')}</div>
                    <div class="expense-payment-info">
                        <div class="expense-paid">Paid: ₹${expense.paid.toLocaleString('en-IN')}</div>
                        <div class="expense-balance">Balance: ₹${balance.toLocaleString('en-IN')}</div>
                    </div>
                    <div class="expense-actions">
                        <button class="btn btn-success btn-sm add-expense-payment-btn" data-id="${expense.id}" data-total="${expense.amount}" data-paid="${expense.paid}"><i class="fas fa-plus"></i> Add Payment</button>
                        <button class="expense-action-btn edit-expense" data-id="${expense.id}"><i class="fas fa-edit"></i></button>
                        <button class="expense-action-btn delete-expense" data-id="${expense.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                expensesList.appendChild(expenseElement);
            });
            
            // Re-attach event listeners to the new buttons
            document.querySelectorAll('.edit-expense').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    editExpense(expenseId);
                });
            });
            
            document.querySelectorAll('.delete-expense').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    deleteExpense(expenseId);
                });
            });
            
            document.querySelectorAll('.add-expense-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const expenseId = parseInt(this.getAttribute('data-id'));
                    const totalAmount = parseInt(this.getAttribute('data-total'));
                    const alreadyPaid = parseInt(this.getAttribute('data-paid'));
                    openPaymentModal('expense', expenseId, totalAmount, alreadyPaid);
                });
            });
        }

        // Update expense payment table
        function updateExpensePaymentTable() {
            const tableBody = document.querySelector('#expenses-payment-table tbody');
            tableBody.innerHTML = '';
            
            if (expensePayments.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: var(--gray);">
                            <i class="fas fa-receipt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            No payment records found
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort payments by date (newest first)
            const sortedPayments = [...expensePayments].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedPayments.forEach(payment => {
                const expense = expensesData.find(expense => expense.id === payment.itemId);
                const expenseName = expense ? expense.name : 'Unknown';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="date">${payment.date}</td>
                    <td>${expenseName}</td>
                    <td>${payment.description}</td>
                    <td class="amount">₹${payment.amount.toLocaleString('en-IN')}</td>
                    <td><span class="status ${payment.status}">${payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm delete-expense-payment-btn" data-id="${payment.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Re-attach event listeners
            document.querySelectorAll('.delete-expense-payment-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const paymentId = parseInt(this.getAttribute('data-id'));
                    deleteExpensePayment(paymentId);
                });
            });
        }

        // Format category for display
        function formatCategory(category) {
            const categoryMap = {
                'borewell': 'Borewell',
                'sump': 'Sump',
                'septic-tank': 'Septic Tank',
                'electrical': 'Electrical',
                'plumbing': 'Plumbing',
                'material': 'Material',
                'labor': 'Labor',
                'other': 'Other'
            };
            return categoryMap[category] || category;
        }

        // Add a new expense
        function addExpense() {
            const name = document.getElementById('expense-name').value;
            const amount = parseInt(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            const notes = document.getElementById('expense-notes').value;
            
            // Generate a new ID
            const newId = expensesData.length > 0 ? Math.max(...expensesData.map(e => e.id)) + 1 : 1;
            
            // Create new expense object
            const newExpense = {
                id: newId,
                name,
                amount,
                paid: 0,
                date,
                category,
                status: "pending",
                notes
            };
            
            // Add to data array
            expensesData.push(newExpense);
            
            // Update display
            updateExpensesDisplay();
            
            // Reset form
            resetExpenseForm();
            
            // Show success message
            alert(`Expense "${name}" added successfully!`);
        }

        // Edit an expense (populate form with existing data)
        function editExpense(expenseId) {
            const expense = expensesData.find(expense => expense.id === expenseId);
            if (!expense) return;
            
            // Populate form with expense data
            document.getElementById('expense-name').value = expense.name;
            document.getElementById('expense-amount').value = expense.amount;
            document.getElementById('expense-date').value = expense.date;
            document.getElementById('expense-category').value = expense.category;
            document.getElementById('expense-notes').value = expense.notes || '';
            
            // Update UI for editing mode
            editingExpenseId = expenseId;
            document.getElementById('form-title').textContent = 'Edit Expense';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-save"></i> Update Expense';
            document.getElementById('cancel-btn').style.display = 'inline-block';
            
            // Scroll to the form
            document.getElementById('expense-form').scrollIntoView({ behavior: 'smooth' });
        }

        // Update an existing expense
        function updateExpense() {
            const name = document.getElementById('expense-name').value;
            const amount = parseInt(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            const category = document.getElementById('expense-category').value;
            const notes = document.getElementById('expense-notes').value;
            
            // Find the expense in our data
            const expenseIndex = expensesData.findIndex(expense => expense.id === editingExpenseId);
            if (expenseIndex === -1) return;
            
            // Update the expense
            expensesData[expenseIndex] = {
                ...expensesData[expenseIndex],
                name,
                amount,
                date,
                category,
                notes
            };
            
            // Update display
            updateExpensesDisplay();
            
            // Reset form and exit editing mode
            cancelExpenseEdit();
            
            // Show success message
            alert(`Expense "${name}" updated successfully!`);
        }

        // Delete an expense
        function deleteExpense(expenseId) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expenseIndex = expensesData.findIndex(expense => expense.id === expenseId);
            if (expenseIndex === -1) return;
            
            const expenseName = expensesData[expenseIndex].name;
            
            expensesData.splice(expenseIndex, 1);
            updateExpensesDisplay();
            alert(`Expense "${expenseName}" deleted successfully!`);
        }

        // Reset the expense form
        function resetExpenseForm() {
            document.getElementById('expense-form').reset();
            document.getElementById('expense-date').valueAsDate = new Date();
        }

        // Cancel editing and reset expense form
        function cancelExpenseEdit() {
            editingExpenseId = null;
            document.getElementById('form-title').textContent = 'Add New Expense';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-save"></i> Save Expense';
            document.getElementById('cancel-btn').style.display = 'none';
            resetExpenseForm();
        }

        // Open payment modal
        function openPaymentModal(type, itemId, totalAmount, alreadyPaid) {
            document.getElementById('payment-type').value = type;
            document.getElementById('payment-item-id').value = itemId;
            document.getElementById('payment-total-amount').value = totalAmount;
            document.getElementById('payment-already-paid').value = alreadyPaid;
            
            // Set modal title
            if (type === 'construction') {
                const stage = constructionData.stages.find(stage => stage.id === itemId);
                document.getElementById('modal-title').textContent = `Add Payment - ${stage.name}`;
            } else {
                const expense = expensesData.find(expense => expense.id === parseInt(itemId));
                document.getElementById('modal-title').textContent = `Add Payment - ${expense.name}`;
            }
            
            // Reset form
            document.getElementById('payment-form').reset();
            document.getElementById('payment-date').valueAsDate = new Date();
            
            // Update payment info
            updatePaymentInfo();
            
            // Show modal
            document.getElementById('payment-modal').classList.add('active');
        }

        // Update payment info based on entered amount
        function updatePaymentInfo() {
            const totalAmount = parseInt(document.getElementById('payment-total-amount').value);
            const alreadyPaid = parseInt(document.getElementById('payment-already-paid').value);
            const paymentAmount = parseInt(document.getElementById('payment-amount').value) || 0;
            
            const balance = totalAmount - alreadyPaid;
            const newBalance = balance - paymentAmount;
            
            document.getElementById('balance-info').textContent = 
                `Remaining balance after this payment: ₹${newBalance.toLocaleString('en-IN')}`;
            
            // Highlight if payment exceeds balance
            if (paymentAmount > balance) {
                document.getElementById('balance-info').style.color = 'var(--danger)';
            } else {
                document.getElementById('balance-info').style.color = 'var(--gray)';
            }
        }

        // Close payment modal
        function closePaymentModal() {
            document.getElementById('payment-modal').classList.remove('active');
        }

        // Save payment
        function savePayment() {
            const type = document.getElementById('payment-type').value;
            const itemId = document.getElementById('payment-item-id').value;
            const totalAmount = parseInt(document.getElementById('payment-total-amount').value);
            const alreadyPaid = parseInt(document.getElementById('payment-already-paid').value);
            const date = document.getElementById('payment-date').value;
            const amount = parseInt(document.getElementById('payment-amount').value);
            const description = document.getElementById('payment-description').value;
            
            // Validate payment amount
            if (amount <= 0) {
                alert('Payment amount must be greater than 0');
                return;
            }
            
            const balance = totalAmount - alreadyPaid;
            if (amount > balance) {
                alert('Payment amount exceeds the remaining balance for this item');
                return;
            }
            
            if (type === 'construction') {
                // Find the stage
                const stageIndex = constructionData.stages.findIndex(stage => stage.id === itemId);
                if (stageIndex === -1) return;
                
                const stage = constructionData.stages[stageIndex];
                const newPaid = stage.paid + amount;
                
                // Update stage payment
                constructionData.stages[stageIndex].paid = newPaid;
                
                // Update stage status
                if (newPaid === totalAmount) {
                    constructionData.stages[stageIndex].status = "completed";
                } else if (newPaid > 0) {
                    constructionData.stages[stageIndex].status = "in-progress";
                }
                
                // Add payment record
                const paymentStatus = newPaid === totalAmount ? 'completed' : 'pending';
                constructionData.payments.push({
                    id: paymentIdCounter++,
                    type: 'construction',
                    itemId: itemId,
                    date: date,
                    amount: amount,
                    description: description,
                    status: paymentStatus
                });
                
                // Update the last updated date
                constructionData.lastUpdated = new Date().toISOString().split('T')[0];
                
                // Update display
                updateConstructionDisplay();
                
            } else {
                // Expense payment
                const expenseId = parseInt(itemId);
                const expenseIndex = expensesData.findIndex(expense => expense.id === expenseId);
                if (expenseIndex === -1) return;
                
                const expense = expensesData[expenseIndex];
                const newPaid = expense.paid + amount;
                
                // Update expense payment
                expensesData[expenseIndex].paid = newPaid;
                
                // Update expense status
                if (newPaid === totalAmount) {
                    expensesData[expenseIndex].status = "paid";
                } else if (newPaid > 0) {
                    expensesData[expenseIndex].status = "pending";
                }
                
                // Add payment record
                const paymentStatus = newPaid === totalAmount ? 'completed' : 'pending';
                expensePayments.push({
                    id: paymentIdCounter++,
                    type: 'expense',
                    itemId: expenseId,
                    date: date,
                    amount: amount,
                    description: description,
                    status: paymentStatus
                });
                
                // Update display
                updateExpensesDisplay();
            }
            
            // Close modal and show success message
            closePaymentModal();
            alert('Payment added successfully!');
        }

        // Delete payment
        function deletePayment(paymentId) {
            if (!confirm('Are you sure you want to delete this payment?')) return;
            
            const paymentIndex = constructionData.payments.findIndex(payment => payment.id === paymentId);
            if (paymentIndex === -1) return;
            
            const payment = constructionData.payments[paymentIndex];
            const stageIndex = constructionData.stages.findIndex(stage => stage.id === payment.itemId);
            
            if (stageIndex !== -1) {
                // Update stage payment
                constructionData.stages[stageIndex].paid -= payment.amount;
                
                // Update stage status
                if (constructionData.stages[stageIndex].paid === 0) {
                    constructionData.stages[stageIndex].status = "pending";
                } else if (constructionData.stages[stageIndex].paid < constructionData.stages[stageIndex].amount) {
                    constructionData.stages[stageIndex].status = "in-progress";
                }
            }
            
            // Remove payment record
            constructionData.payments.splice(paymentIndex, 1);
            
            // Update display
            updateConstructionDisplay();
            alert('Payment deleted successfully!');
        }

        // Delete expense payment
        function deleteExpensePayment(paymentId) {
            if (!confirm('Are you sure you want to delete this payment?')) return;
            
            const paymentIndex = expensePayments.findIndex(payment => payment.id === paymentId);
            if (paymentIndex === -1) return;
            
            const payment = expensePayments[paymentIndex];
            const expenseIndex = expensesData.findIndex(expense => expense.id === payment.itemId);
            
            if (expenseIndex !== -1) {
                // Update expense payment
                expensesData[expenseIndex].paid -= payment.amount;
                
                // Update expense status
                if (expensesData[expenseIndex].paid === 0) {
                    expensesData[expenseIndex].status = "pending";
                } else if (expensesData[expenseIndex].paid < expensesData[expenseIndex].amount) {
                    expensesData[expenseIndex].status = "pending";
                }
            }
            
            // Remove payment record
            expensePayments.splice(paymentIndex, 1);
            
            // Update display
            updateExpensesDisplay();
            alert('Payment deleted successfully!');
        }
    </script>
</body>
</html>
